# Chrome でのデバッグ

より複雑なコードを書く前に、デバッグについて話しましょう。

すべての現代のブラウザとその他のほとんどの環境は "デバッグ" をサポートしています。 -- 開発ツールの特別なUIで、エラーの発見と修正がはるかに簡単になります。

この観点では、恐らく最も機能が充実してるので、ここではChromeを使いましょう。

[cut]

## "sources" ペイン [#the-sources-pane]

あなたのChromeのバージョンでは、少し違って見えるかもしれませんが、そこが何かは明白でしょう。

- Chromeの [example page](debugging/index.html) を開きます。
- `key:F12` (Mac: `key:Cmd+Opt+I`) で開発者ツールをONにします。
- `source` ペインを選択します。

もしも、初めてそれをしているなら、見るべきものがあります:

![](chrome-open-sources.png)

トグルボタン <span class="devtools" style="background-position:-168px -76px"></span> はファイルを表示するタブを開きます。
それをクリックして、`index.html` 、次にツリービューの `hello.js` を選択しましょう。ここで表示される内容は次の通りです:

![](chrome-tabs.png)

ここで私たちは3つの領域をみることができます:

1. **リソース領域** html、JavaScript, css や、ページに紐付いているイメージなどを含む他のファイルがリストされます。
2. **ソース領域** ソースコードを表示します。
3. **情報と制御領域** これはデバッグのためで、我々は後ほどすぐにそれを探索します。

あたなは同じトグル <span class="devtools" style="background-position:-200px -76px"></span> を再びクリックすることで、リソースのリストやコードを隠すことができます。

## コンソール [#console]

もしも、`Esc` を押したら、コンソールが下に表示されます。そこでコマンドをうち、`key:Enter` で実行することが出来ます。

文が実行された後、その決kは下に表示されます。

例えば、ここで `1+2 ` は `3` になり、`hello("debugger")` は何も返さないので、その結果は `undefined` です:

![](chrome-sources-console.png)

## ブレイクポイント [#breakpoints]

[example page](debugging/index.html) のコード内で何が起こっているのか見てみましょう。`hello.js` で、行番号 `4` をクリックします。はい、コードではなく、 `"4"` の数字の右です。

おめでとうございます! あなたはブレイクポイントをセットしました。行 `8` の数字もクリックしましょう。

このようになるはずです(青はあなたがクリックした場所です):

![](chrome-sources-breakpoint.png)

*ブレイクポイント* はデバッガーが自動でJavaScriptの実行を停止するコードのポイントです。

コードが停止している間、私たちは現在の変数を検査したり、コンソールでコマンドを実行することができます。言い換えると、そこでデバッグができます。

右のペインでは、常にプレイクポイントの一覧を見つけることができます。私たちが色々なファイルで多くのブレイクポイントを持っているとき、役に立ちます。それは次を可能にします:

- コード中のブレイクポイントに素早く移動します(右ペインでそれをクリックすることで)
- それのチェックを外すことで、一時的にブレイクポイントを無効にします
- 右クリックして削除を選択することで、ブレイクポイントを削除します。
- ...など。

```smart header="条件付きのブレイクポイント"
行番号の *右クリック* で *条件付きの* ブレイクポイントを作ることができます。与えられた式が真の場合にのみトリガします。

これは特定の変数値、もしくは関数パラメータに対してのみ停止する必要がある場合に便利です。
```

## デバッガーコマンド [#debugger-command]

このように、`debugger` コマンドを使うことでもコードを停止することができます:

```js
function hello(name) {
  let phrase = `Hello, ${name}!`;

*!*
  debugger;  // <-- デバッガはここで止まります
*/!*

  say(phrase);
}
```

これは、私たちがコードエディタの中にいて、ブラウザに切り替えて開発者ツールのスクリプトを参照してブレイクポイントをセットしたくないときに非常に便利です。

## 一時停止して見回す [#pause-and-look-around]

私たちの例では、`hello()` はページロード中に呼び出されるので、デバッガーを起動する最も簡単な方法はページを再読込することです。なので、 `key:F5` (Windows, Linux)または `key:Cmd+R` (Mac) を押しましょう。

ブレイクポイントがセットされているので、実行は4行目で一時停止します。:

![](chrome-sources-debugger-pause.png)

情報のドロップダウンを右に開いてください(矢印のラベルがついています)。現在のコードの状態を調べることができます:

1. **`Watch` -- 任意の式の現在の値を表示します。**

    `+` をクリックし、式を入力することができます。デバッガーは、いつでもその値を表示し、実行中に自動的に再計算を行います。

2. **`Call Stack` -- ネストされた呼び出しのチェインを表示します。**

    現時点では、デバッガーは `hello()` 呼び出しの内側におり、`index.html` のスクリプト(そこに関数はないので、 "anonymous" と呼ばれます)によって呼び出されました。

    スタックの項目をクリックすると、デバッガーは該当のコードにジャンプし、すべての変数も同様に調べられます。

3. **`Scope` -- 現在の変数。**

    `Local` はローカル関数の変数を表示します。また、ソース上でも、ハイライト表示されたそれらの値を見ることができます。

    `Global` はグローバル変数を持っています

    そこには、我々がまだ学んでいない `this` キーワードもありますが、もうすぐ学びます。

## 実行を追跡する [#tracing-the-execution]

今後はスクリプトを *追跡* する時間です。

右ペインの上部にそのためのボタンがあります。それを使ってみましょう。

<span class="devtools" style="background-position:-7px -76px"></span> -- 実行の継続, ホットキー `key:F8`.
: 実行を再開します。もしも他にブレイクポイントがなければ、そのまま実行が継続され、デバッガの制御から外れます。

    これは、それをした後に見える画面です:

    ![](chrome-sources-debugger-trace-1.png)

    実行は再開され、`say()` の中の別のブレイクポイントに到達し、そこで一時停止します。右の "Call stack" を少しみてください。もう一度呼び出すことで増えています。私たちは、今 `say()` の中にいます。

<span class="devtools" style="background-position:-137px -76px"></span> -- 一歩を踏み出します (次のコマンドを実行します)が、*関数の中には入りません*, ホットキー `key:F10`。
: 今すぐクリックすると `alert`が表示されます。 重要なのは、 `alert` はどの関数でも可能であり、実行は関数内部に入るのをスキップして実行するということです。

<span class="devtools" style="background-position:-72px -76px"></span> -- 一歩を踏み出します, ホットキー `key:F11`.
: 1つ前と同じですが、ネストされた関数に "ステップイン" します。。これをクリックすると、全てのスクリプトが1つずつ実行されます。

<span class="devtools" style="background-position:-104px -76px"></span> -- 現在の関数の最後まで実行を継続します、ホットキー `key:Shift+F11`。
: 現在の関数のほぼ最後の行で実行が停止するでしょう。私たちが<span class="devtools" style="background-position:-72px -76px"></span>を使ってネストされた呼び出しに誤って入ったときには便利ですが、それは我々には興味はなく、できるだけできるだけ早く終了したいと考えています。

<span class="devtools" style="background-position:-7px -28px"></span> -- すべてのブレイクポイントの有効/無効
: そのボタンは実行を動かしません。ただブレイクポイントの on/off を切り替えます。

<span class="devtools" style="background-position:-264px -4px"></span> -- エラー発生時の自動一時停止の有効/無効
: 有効していて、開発者ツールを開いている場合、スクリプトエラーが起きると実行が自動で一時停止します。そして、私たちは何が間違っていたかを見るために変数を分析することが出来ます。従って、もしもスクリプトがエラーで死んだら、どこで死んでその時どんなコンテキストであるかを見るために、デバッガを起動し、このオプションを有効にしてページを再読込しましょう。

```smart header="Continue to here"
コードの行で右クリックすると、"Continue to here" と呼ばれる素晴らしい選択肢を持つコンテキストメニューが開きます。

それは、複数のステップを進めたいが、ブレイクポイントをセットするのが面倒なときに便利です。
```

## ロギング [#logging]

コンソールに何かを出力するために、`console.log` 関数があります。

例えば、これはコンソールに `0` から `4` までの値を出力します:

```js run
// open console to see
for (let i = 0; i < 5; i++) {
  console.log("value", i);
}
```

コンソールの中なので、通常のユーザはその出力を見ません。それを見るためには、開発者ツールのコンソールタブを開くか、別のタブで `key:Esc` を押します。 :下にコンソールが表示されます。

コードに十分なログを仕込んでいれば、デバッガーなしで、その記録から何が行っているか知ることが出来ます。
If we have enough logging in our code, then we can see what's going on from the records, without the debugger.

## サマリ [#summary]

ご覧のとおり、スクリプトを一時停止するには主に3つの方法があります。
1. ブレイクポイント
2. `debugger` 構文
3. エラー (開発者ツールを開き、ボタン <span class="devtools" style="background-position:-264px -4px"></span> を ON にしている場合)

そして、変数を検査し、実行が間違っている場所を確認することができます。

ここでカバーした以上に、開発者ツールには多くのオプションがあります。完全なマニュアルは <https://developers.google.com/web/tools/chrome-devtools>です。

このチャプターの情報はデバッグを始めるのには十分ですが、今後、特にブラウザの作業が多い場合は、そこに行って開発者ツールのより高度な機能を調べてください。

また、開発者ツールの色んな場所をクリックすることで何が表示されるかを見ることが出来ます。恐らくそれは開発者ツールを学ぶのに最も近道です。同様に右クリックも忘れないように!
